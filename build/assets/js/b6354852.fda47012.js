"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7987],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var s=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},o=Object.keys(e);for(s=0;s<o.length;s++)n=o[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=s.createContext({}),u=function(e){var t=s.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=u(e.components);return s.createElement(c.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},d=s.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=u(n),h=r,f=d["".concat(c,".").concat(h)]||d[h]||l[h]||o;return n?s.createElement(f,a(a({ref:t},p),{},{components:n})):s.createElement(f,a({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,a=new Array(o);a[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,a[1]=i;for(var u=2;u<o;u++)a[u]=n[u];return s.createElement.apply(null,a)}return s.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8275:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return u},assets:function(){return p},toc:function(){return l},default:function(){return h}});var s=n(7462),r=n(3366),o=(n(7294),n(3905)),a=["components"],i={},c="Testing",u={unversionedId:"concepts/testing",id:"concepts/testing",title:"Testing",description:"Fusio provides a complete Test-Setup for your API endpoints. In the Fixture.php class it is also possible to define",source:"@site/docs/concepts/testing.md",sourceDirName:"concepts",slug:"/concepts/testing",permalink:"/docs/concepts/testing",editUrl:"https://github.com/apioo/fusio-docs/edit/main/docs/concepts/testing.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Social Login",permalink:"/docs/concepts/social_login"},next:{title:"User attributes",permalink:"/docs/concepts/user_attributes"}},p={},l=[{value:"Development",id:"development",level:2}],d={toc:l};function h(e){var t=e.components,n=(0,r.Z)(e,a);return(0,o.kt)("wrapper",(0,s.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"testing"},"Testing"),(0,o.kt)("p",null,"Fusio provides a complete Test-Setup for your API endpoints. In the ",(0,o.kt)("inlineCode",{parentName:"p"},"Fixture.php")," class it is also possible to define\nfixture data which is inserted for every test case. Please take a look at the tests of our\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apioo/fusio-sample-cms/tree/master/tests"},"sample cms repository")," to see some live test examples."),(0,o.kt)("p",null,"The idea is that each endpoint has a corresponding test case class which tests the GET, POST, PUT and DELETE method of\nthe resource. Internally we can send an HTTP request to Fusio without the need to setup an HTTP server. This makes these\ntests very fast and efficient."),(0,o.kt)("p",null,"The Method ",(0,o.kt)("inlineCode",{parentName:"p"},"Fixture::append")," returns the data set which is inserted for every test case. There we insert a fixed access\ntoken with the fitting rights so that we can call our protected API endpoints."),(0,o.kt)("p",null,"You can execute those tests inside the Fusio directory root with a simple phpunit command (because of the available\n",(0,o.kt)("inlineCode",{parentName:"p"},"phpunit.xml")," configuration):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"phpunit\n")),(0,o.kt)("h2",{id:"development"},"Development"),(0,o.kt)("p",null,"Every test case should extend from the ",(0,o.kt)("inlineCode",{parentName:"p"},"ApiTestCase")," class. The test case contains a test method for every HTTP method\ni.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"testGet"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"testPost"),", etc. Every test makes the appropriated call to the API endpoint. Then we assert the response\nbody and if needed also the headers (for larger response bodies it is recommended to move the expected JSON payload to\nan external file which is then included i.e. through ",(0,o.kt)("inlineCode",{parentName:"p"},"file_get_contents"),"). Through this way we can simply assure that our\nAPI works as expected. The following shows a simple API test case from the example todo entity API endpoint:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nclass EntityTest extends ApiTestCase\n{\n    public function testGet()\n    {\n        $response = $this->sendRequest('/todo/4', 'GET', [\n            'User-Agent'    => 'Fusio TestCase',\n        ]);\n\n        $actual = (string) $response->getBody();\n        $actual = preg_replace('/\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}/', '0000-00-00 00:00:00', $actual);\n        $expect = <<<'JSON'\n{\n    \"id\": \"4\",\n    \"status\": \"1\",\n    \"title\": \"Task 4\",\n    \"insertDate\": \"0000-00-00 00:00:00\"\n}\nJSON;\n\n        $this->assertEquals(200, $response->getStatusCode(), $actual);\n        $this->assertJsonStringEqualsJsonString($expect, $actual, $actual);\n    }\n\n    public function testPost()\n    {\n        $response = $this->sendRequest('/todo/4', 'POST', [\n            'User-Agent'    => 'Fusio TestCase',\n        ]);\n\n        $actual = (string) $response->getBody();\n        $expect = <<<'JSON'\n{\n    \"success\": false,\n    \"title\": \"Internal Server Error\",\n    \"message\": \"Given request method is not supported\"\n}\nJSON;\n\n        $this->assertEquals(405, $response->getStatusCode(), $actual);\n        $this->assertJsonStringEqualsJsonString($expect, $actual, $actual);\n    }\n\n    public function testPut()\n    {\n        $response = $this->sendRequest('/todo/4', 'PUT', [\n            'User-Agent'    => 'Fusio TestCase',\n        ]);\n\n        $actual = (string) $response->getBody();\n        $expect = <<<'JSON'\n{\n    \"success\": false,\n    \"title\": \"Internal Server Error\",\n    \"message\": \"Given request method is not supported\"\n}\nJSON;\n\n        $this->assertEquals(405, $response->getStatusCode(), $actual);\n        $this->assertJsonStringEqualsJsonString($expect, $actual, $actual);\n    }\n\n    public function testDelete()\n    {\n        $response = $this->sendRequest('/todo/4', 'DELETE', [\n            'User-Agent'    => 'Fusio TestCase',\n            'Authorization' => 'Bearer da250526d583edabca8ac2f99e37ee39aa02a3c076c0edc6929095e20ca18dcf'\n        ]);\n\n        $actual = (string) $response->getBody();\n        $expect = <<<'JSON'\n{\n    \"success\": true,\n    \"message\": \"Delete successful\"\n}\nJSON;\n\n        $this->assertEquals(200, $response->getStatusCode(), $actual);\n        $this->assertJsonStringEqualsJsonString($expect, $actual, $actual);\n\n        /** @var \\Doctrine\\DBAL\\Connection $connection */\n        $connection = Environment::getService('connector')->getConnection('Default-Connection');\n        $actual = $connection->fetchAssoc('SELECT id, status, title FROM app_todo WHERE id = 4');\n        $expect = [\n            'id' => 4,\n            'status' => 0,\n            'title' => 'Task 4',\n        ];\n\n        $this->assertEquals($expect, $actual);\n    }\n\n    public function testDeleteWithoutAuthorization()\n    {\n        $response = $this->sendRequest('/todo/4', 'DELETE', [\n            'User-Agent'    => 'Fusio TestCase',\n        ]);\n\n        $actual = (string) $response->getBody();\n        $expect = <<<'JSON'\n{\n    \"success\": false,\n    \"title\": \"Internal Server Error\",\n    \"message\": \"Missing authorization header\"\n}\nJSON;\n\n        $this->assertEquals(401, $response->getStatusCode(), $actual);\n        $this->assertJsonStringEqualsJsonString($expect, $actual, $actual);\n    }\n}\n")))}h.isMDXComponent=!0}}]);